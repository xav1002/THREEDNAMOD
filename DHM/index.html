<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Double-Helix Model</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="main1.css">
</head>
<body>
    <div id="blocker">

        <div id="instructions">
            <span style="font-size:40px">Click</span>
            <br />
            (W, A, S, D = Move, SPACE = Move Up, SHIFT = Move Down, MOUSE = Look around)
        </div>

    </div>



    <script src="../three.js"></script>
    <script src="../FirstPersonControls.js"></script>
    <script src="../PointerLockControls.js"></script>

    <script>

        var camera, controls, scene, renderer, material;

        var moveForward = false;
        var moveBackward = false;
        var moveLeft = false;
        var moveRight = false;
        var moveUp = false;
        var moveDown = false;
        var canJump = false;

        var prevTime = performance.now();
        var velocity = new THREE.Vector3();
        var direction = new THREE.Vector3();
        var vertex = new THREE.Vector3();

        init();
        animate();

        function init () {
            camera = new THREE.PerspectiveCamera(35, window.innerWidth / window.innerHeight, 0.1, 3000);

            scene = new THREE.Scene();

            var light = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(light);

            var light1 = new THREE.PointLight(0xffffff, 0.5);
            scene.add(light1);

            geometry = new THREE.BoxGeometry(10, 10, 10);

            material = new THREE.MeshBasicMaterial({
            color: 0xff0000,
            transparent: true,
            opacity: 1,
            // map: new THREE.TextureLoader().load(url)
            wireframe: true,
            wireframeLinewidth: 5,
            wireframeLinejoin: 'round',
            wireframeLinecap: 'round'
        });

            mesh = new THREE.Mesh(geometry, material);
            mesh.position.z = -1000;
            mesh.position.x = 0;

        controls = new THREE.PointerLockControls( camera );

        var blocker = document.getElementById('blocker');
        var instructions = document.getElementById('instructions');

				instructions.addEventListener( 'click', function () {
                    controls.lock();
                    console.log("works");
				}, false );
				controls.addEventListener( 'lock', function () {
					instructions.style.display = 'none';
					blocker.style.display = 'none';
				} );
				controls.addEventListener( 'unlock', function () {
					blocker.style.display = 'block';
					instructions.style.display = '';
                } );

                scene.add(controls.getObject());

                renderer = new THREE.WebGLRenderer( { antialias: true } );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
                document.body.appendChild( renderer.domElement );

                var onKeyDown = function ( e ) {

                    switch ( e.keyCode ) {

                        case 38: // up
                        case 87: // w
                                moveForward = true;
                                console.log(moveForward);
                                break;

                        case 37: // left
                        case 65: // a
                                moveLeft = true;
                                break;

                        case 40: // down
                        case 83: // d
                                moveBackward = true;
                                break;

                        case 39: // right
                        case 68: // d
                                moveRight = true;
                                break;

                        case 32: // up
                                moveUp = true;
                                break;

                        case 16: // down
                                moveDown = true;
                                break;
                            }
                    };

                    var onKeyUp = function ( e ) {

                    switch ( e.keyCode ) {

                        case 38: // up
                        case 87: // w
                                moveForward = false;
                                break;

                        case 37: // left
                        case 65: // a
                                moveLeft = false;
                                break;

                        case 40: // down
                        case 83: // d
                                moveBackward = false;
                                break;

                        case 39: // right
                        case 68: // d
                                moveRight = false;
                                break;

                        case 32: // up
                                moveUp = false;
                                break;

                        case 16: // down
                                moveDown = false;
                                break;
                            }
                    };
            document.addEventListener( 'keydown', onKeyDown, false);
            document.addEventListener( 'keyup', onKeyUp, false);

            function animate() {
                    requestAnimationFrame( animate );

					var time = performance.now();
					var delta = ( time - prevTime ) / 1000;
					velocity.x -= velocity.x * 7.5 * delta;
                    velocity.z -= velocity.z * 7.5 * delta;
                    velocity.y -= velocity.y * 7.5 * delta;

					direction.z = Number( moveForward ) - Number( moveBackward );
                    direction.x = Number( moveLeft ) - Number( moveRight );
                    direction.y = Number( moveUp ) - Number( moveDown );
					direction.normalize(); // this ensures consistent movements in all directions
					if ( moveForward || moveBackward ) {
                        console.log("works");
                        velocity.z -= direction.z * 4000.0 * delta
                    };
					if ( moveLeft || moveRight ) {
                        velocity.x -= direction.x * 4000.0 * delta
                    };
                    if (moveUp || moveDown) {
                        velocity.y += direction.y * 4000.0 * delta
                    }

					controls.getObject().translateX( velocity.x * delta );
					controls.getObject().translateY( velocity.y * delta );
					controls.getObject().translateZ( velocity.z * delta );

                    prevTime = time;
                    renderer.render( scene, camera );
                }
        }




    </script>
</body>
</html>